/**
 * Margin content
 * This is the area to the right of the main content
 * normally covered by the in-page table of contents
 * but if `.margin` classes are present, it shows up to the right in the margin
 * and the in-page TOC is hidden.
 * On narrow screens, margin content behaves like a sidebar
 */ 

/** 
 * Variables
 */
// The % is relative to our parent container, which has width == max-width
// full-width = 100% = content-max-width + margin-width
// We must express margin-width as a percentage of max-width. So:
// So the width we want is:
// max-width * x = 100% - max-width, so we solve for x.
// Will be a decimal
$content-margin-gutter: 3%;
$content-margin-width: percentage(
    (100% - $content-max-width) / $content-max-width
  ) - $content-margin-gutter;
$content-margin-offset: (-$content-margin-width - $content-margin-gutter);

// Express 100% in parent container in % units of the child container.
$content-fullwidth-width: percentage(100% / $content-max-width);

/**
 * This mixin will cause something to "pop out" to the margin on wide screens
 */
@mixin margin-content() {
  width: 40%;
  float: right;
  background-color: unset;
  border-left: 1px var(--pst-color-border) solid;
  font-size: 0.9em;
  // This is the wide-screen behavior
  @media (min-width: $breakpoint-md) {
    border: none;
    width: $content-margin-width;
    margin: 0 $content-margin-offset 0 0;
    // Prevent sequential margin content from overlapping
    clear: right;
    // Slight padding so that admonition shadows still show
    padding-right: .25rem;

    p.sidebar-title {
      margin-bottom: -1rem;
      border-bottom: none;
      padding-left: 0px;

      // Content of admonitions has fewer horizontal white space to save space
      ~ * {
        padding-left: 0px;
        padding-right: 0px;
      }
    }
  }
}

/**
 * Sidenotes and marginnotes
 * over-rides the "footnote" behavior to pop out to the margin instead.
 */
label.margin-toggle {
  margin-bottom: 0em;
  &.marginnote-label {
    display: none;
  }
  sup {
    user-select: none;
  }
  @media (max-width: $breakpoint-md) {
    cursor: pointer;
    color: rgb(0, 113, 188);
    &.marginnote-label {
      display: inline;
      &:after {
        content: "\2295";
      }
    }
  }
}

input.margin-toggle {
  display: none;
  @media (max-width: $breakpoint-md) {
    &:checked + .sidenote,
    &:checked + .marginnote {
      display: block;
      float: left;
      left: 1rem;
      clear: both;
      width: 95%;
      margin: 1rem 2.5%;
      position: relative;
    }
  }
}

span.sidenote,
span.marginnote {
  z-index: $zindex-middle;
  position: relative;
  sup {
    user-select: none;
  }
  @include margin-content();
  border-left: none;
  @media (max-width: $breakpoint-md) {
    display: none;
  }
}

aside.sidebar {
  .note {
    // styling for notes inside sidebars
    margin: 1rem;
    padding: 0rem 0rem 1rem 0rem;
  }
  // The titles sticking
  .admonition-title {
    margin: 0rem -1rem 0rem 0rem;
  }
}

aside.sidebar.margin {
  .note {
    margin: 1rem 0rem;
  }
}

div.margin,
figure.margin,
aside.margin,
.cell.tag_popout,
.cell.tag_margin {
  z-index: $zindex-middle;
  position: relative;
  @include margin-content();

  // Make cell outputs take up more space if they're in the margin
  div.cell.tag_margin .cell_output {
    padding-left: 0;
  }
}

// A few permutations because docutils 0.18 switched to semantic tags
div.figure.margin-caption p.caption,
div.figure.margin-caption figcaption,
figure.margin-caption figcaption {
  z-index: $zindex-middle;
  position: relative;
  @include margin-content();
}

// Margin captions
.margin-caption figcaption {
  text-align: left;
}

/**
 * Full width content
 */
div.cell.tag_full-width,
div.cell.tag_full_width,
div.full_width,
div.full-width {
  z-index: $zindex-middle;
  position: relative;
  @media (min-width: $breakpoint-md) {
    max-width: $content-fullwidth-width;
    width: $content-fullwidth-width;
  }
}
